{% extends "base.html" %}
{% block content %}
<section class="mili-head">
  <div>
    <h2>–ú–æ—ë –ª–æ–≥–æ–≤–æ</h2>
    <div class="muted">–ï–Ω–æ—Ç: <b>{{ username }}</b></div>
    
    <div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 8px;">
      <div>–°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–∞–π–Ω–∏–∫:</div>
      <a href="/public/{{ username }}" target="_blank" id="public-link-text" style="font-weight:bold; word-break: break-all;">
        /public/{{ username }}
      </a>
      <button class="btn ghost" onclick="copyLink()" style="margin-left: 10px; font-size: 0.8em;">
        –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
      </button>
    </div>
  </div>
</section>

<section class="panel">
  <h3>–ù–æ–≤—ã–π —Ç–∞–π–Ω–∏–∫</h3>
  <form class="form" method="post" action="/stash/create">
    <label>–ù–∞–∑–≤–∞–Ω–∏–µ
      <input name="title" maxlength="64" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —É–ª–æ–≤" />
    </label>
    <label>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ
      <textarea name="content" rows="4" maxlength="4096" required placeholder="—Å—é–¥–∞ –º–æ–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å —á—Ç–æ —É–≥–æ–¥–Ω–æ..."></textarea>
    </label>
    <button class="btn" type="submit">–°–ø—Ä—è—Ç–∞—Ç—å</button>
  </form>
</section>

<section class="grid">
  {% if stashes|length == 0 %}
    <div class="empty">
      –ü–æ–∫–∞ –ø—É—Å—Ç–æü¶ù‚ú®
    </div>
  {% endif %}

  {% for s in stashes %}
    <div class="stash">
      <div class="stash-h">ü¶ù {{ s.title }}</div>
      <div class="stash-c">{{ s.content }}</div>
      <div class="stash-meta">id={{ s.id }} ¬∑ {{ s.created_at }}</div>

      <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
        <button class="btn ghost" type="button" onclick="copyLink()">
          üîó –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
        </button>
      </div>
    </div>
  {% endfor %}
</section>

<script>
function copyLink() {
  const fullLink = window.location.origin + "/public/{{ username }}";
  
  navigator.clipboard.writeText(fullLink).then(() => {
    alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞:\n" + fullLink);
  }).catch(err => {
    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
    prompt("–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –≤—Ä—É—á–Ω—É—é:", fullLink);
  });
}
</script>
{% endblock %}